

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>[RTL8722CSM] [RTL8722DM] Use Firebase To Push Messaging Services &mdash; amebaDocs 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="[RTL8722CSM][RTL8722DM] Access IFTTT Via Ameba" href="%5BRTL8722CSM%5D%5BRTL8722DM%5D%20Access%20IFTTT%20Via%20Ameba.html" />
    <link rel="prev" title="[RTL8722CSM] [RTL8722DM] Use MDNS To Let Arduino IDE Find Ameba" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20MDNS%20To%20Let%20Arduino%20IDE%20Find%20Ameba.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> amebaDocs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Open Source SDKs:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../source/arduino_index.html">Arduino SDK</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html">AmebaD</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../ambd_mini/source/index.html">AmebaD-mini</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../ambd_mini/source/getting_started/RTL8722DM_mini_Arduino%20SDK_getting%20start.html">Getting Started with RTL8722DM_mini</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ambd_mini/source/download/index.html">Download</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../ambd_mini/source/peripherals_and_examples/index.html">Peripherals &amp; Examples</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../../ambd_mini/source/peripherals_and_examples/RTL8722DM_MINI_Arduino_SDK_basic_example_table%2015Apr2021.html">Basic Examples</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="Network%20Examples.html">Network Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="Peripheral%20Examples.html">Peripheral Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="Components%20used.html">Components used</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../ambd_mini/source/board_hdk/index.html">Board HDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ambd_mini/source/api_documents/index.html">API Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ambd_mini/source/resources/index.html">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ambd_mini/source/support/index.html">Support</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ambd_micropython/source/index.html">Micropython SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ambd_sdk/source/index.html">Standard SDK</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">amebaDocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../source/arduino_index.html">Arduino SDK</a> &raquo;</li>
        
          <li><a href="../index.html">AmebaD</a> &raquo;</li>
        
          <li><a href="index.html">Peripherals &amp; Examples</a> &raquo;</li>
        
          <li><a href="Network%20Examples.html">Network Examples</a> &raquo;</li>
        
      <li>[RTL8722CSM] [RTL8722DM] Use Firebase To Push Messaging Services</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/ambd_arduino/source/peripherals_and_examples/[RTL8722CSM] [RTL8722DM] Use Firebase To Push Messaging Services.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rtl8722csm-rtl8722dm-use-firebase-to-push-messaging-services">
<h1>[RTL8722CSM] [RTL8722DM] Use Firebase To Push Messaging Services<a class="headerlink" href="#rtl8722csm-rtl8722dm-use-firebase-to-push-messaging-services" title="Permalink to this headline">¶</a></h1>
<p>Preparation</p>
<ul class="simple">
<li><p>Ameba x 1</p></li>
<li><p>Android Studio</p></li>
<li><p>Smart phone with Google Play Service x 1</p></li>
</ul>
<p>Example</p>
<p>In the era of the popularity of smart phones, people often receive
reminders from specific apps. In this example, we will teach how to use
Google Firebase to send messages from the Ameba Client to mobile phones.</p>
<p>First, we use Firebase Cloud Messaging (FCM) as a cross-platform
messaging solution that lets you deliver messages for free and reliably.</p>
<p>With FCM, you can notify your client application (App) to sync emails or
other data. You can send a message to drive user engagement. For instant
messaging content, a message can transfer up to 4KB of payload to the
client application.</p>
<a class="reference internal image-reference" href="../../../_images/image160.png"><img alt="1" src="../../../_images/image160.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>The FCM implementation includes two main parts for sending and
receiving:</p>
<div class="line-block">
<div class="line">1. A trusted environment, such as Cloud Functions for Firebase or an
application server for building, locating, and sending messages.</div>
<div class="line">2. Receive iOS, Android or Web (JavaScript) client applications for
messages.</div>
</div>
<p>You can use <a class="reference external" href="https://firebase.google.com/docs/cloud-messaging/admin/">Admin
SDK</a> or <a class="reference external" href="https://firebase.google.com/docs/cloud-messaging/server">HTTP&amp;XMPP
API</a> to send
messages.To test or send marketing or engagement messages with powerful
built-in targeting and analytics, you can also use<a class="reference external" href="https://console.firebase.google.com/u/0/project/_/notification?pli=1">Notifications
composer</a></p>
<p>We know that Ameba can send messages to specific apps as long as it
implements the http client function.</p>
<p>First of all, we must first set up an environment for developing Android
apps. Please download Android Studio first on Android official website.</p>
<p><a class="reference external" href="https://developer.android.com/studio/install">https://developer.android.com/studio/install</a></p>
<p>Then we can use the Android example provided by Firebase to download
Firebase Quickstart Samples.</p>
<p><a class="reference external" href="https://github.com/firebase/quickstart-android">https://github.com/firebase/quickstart-android</a></p>
<p>Open Android Studio and click on Import Project, select the messaging
project in Firebase Quickstart Samples. Since we won’t use other
functions, we can only choose the messaging project.</p>
<p>Android Studio will need to install the SDK and Google repository for
the first time to start the messaging project. You can refer to the
following page for update.</p>
<p><a class="reference external" href="https://developer.android.com/studio/intro/update">https://developer.android.com/studio/intro/update</a></p>
<p>Wait until the required components for compiling the app are installed,
you can open the messaging project, and Android Studio comes with the
Firebase registration function.</p>
<a class="reference internal image-reference" href="../../../_images/image258.png"><img alt="1" src="../../../_images/image258.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>As shown above, open the toolbar and click Tools-&gt;Select Firebase.</p>
<a class="reference internal image-reference" href="../../../_images/image338.png"><img alt="1" src="../../../_images/image338.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Open Firebase Assisant in the right pane, then see Cloud Messaging,
select Set up Firebase Cloud Messaging to start the registration
process.</p>
<a class="reference internal image-reference" href="../../../_images/image432.png"><img alt="1" src="../../../_images/image432.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Click Connect to Firebase</p>
<a class="reference internal image-reference" href="../../../_images/image518.png"><img alt="1" src="../../../_images/image518.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Then bring out the page, and click on Firebase on the left and log in to
the Gmail account. Once you log in, you will be taken to the Firebase
homepage.</p>
<a class="reference internal image-reference" href="../../../_images/image68.png"><img alt="1" src="../../../_images/image68.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Let’s keep the homepage first, we need to go to the Firebase Console and
go back to Android Studio.</p>
<a class="reference internal image-reference" href="../../../_images/image76.png"><img alt="1" src="../../../_images/image76.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>We can see that when the webpage is successfully logged in, Android
Studio also brings up the login information dialog box, click connect to
Firebase</p>
<a class="reference internal image-reference" href="../../../_images/image84.png"><img alt="1" src="../../../_images/image84.png" style="width: 6.5in; height: 5.43681in;" /></a>
<div class="line-block">
<div class="line">You can see Dependencies set up correctly in the right pane and see a
google-service.json file in the left pane, indicating that the app has
been registered successfully.</div>
<div class="line">At this point, you can connect your phone to your computer (press
Shift+F10) or press the Runs App in the toolbar. Please note here that
Firebase requires a mobile phone to provide Google play service (GPS)
service. An example of not being able to use Firebase without
installing Google Play.</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image94.png"><img alt="1" src="../../../_images/image94.png" style="width: 4.6875in; height: 4.6875in;" /></a>
<p>As shown above, the messaging app is installed and executed successfully
on the phone. Click LOG TOKEN at this time.</p>
<a class="reference internal image-reference" href="../../../_images/image103.png"><img alt="1" src="../../../_images/image103.png" style="width: 4.6875in; height: 4.6875in;" /></a>
<p>There will be a Token ID, which is the Access Token required to send the
message, representing the ID of the FCM service APP installed on a
particular phone. This ID is unique and will be reassigned when the app
is removed and re-installed. It means that the message can be sent to a
specific phone. The FCM service can also push messages to a NEWS
(Topic). This section can be found in Firebase topic-messaging:</p>
<p><a class="reference external" href="https://firebase.google.com/docs/cloud-messaging/android/topic-messaging">https://firebase.google.com/docs/cloud-messaging/android/topic-messaging</a></p>
<p>Therefore, we need to save this Access Token, return to Android Studio
as shown below, select Debug at the log level of the Logcat. When you
press the LOG TOKEN button on the App, Logcat will print out the Access
Token ID. We will save the code after the InstanceID Token: in the Log
message.</p>
<a class="reference internal image-reference" href="../../../_images/image1112.png"><img alt="1" src="../../../_images/image1112.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Then we have to go back to the page that was brought when we first
logged into Firebase.</p>
<a class="reference internal image-reference" href="../../../_images/image68.png"><img alt="1" src="../../../_images/image68.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Click in the upper right corner to go to the console</p>
<a class="reference internal image-reference" href="../../../_images/image1212.png"><img alt="1" src="../../../_images/image1212.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>At this point, You can see that Android Studio has just built the
messaging project for us in the operation.</p>
<a class="reference internal image-reference" href="../../../_images/image1311.png"><img alt="1" src="../../../_images/image1311.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Click to enter the messaging project with settings page, as shown above.</p>
<a class="reference internal image-reference" href="../../../_images/image1411.png"><img alt="1" src="../../../_images/image1411.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Select Set up</p>
<a class="reference internal image-reference" href="../../../_images/image1510.png"><img alt="1" src="../../../_images/image1510.png" style="width: 6.5in; height: 5.43681in;" /></a>
<div class="line-block">
<div class="line">Go to the Settings page and select the Cloud Messaging page. We will
see the Legacy server key. This Server key also needs to be used in
the program. Let’s save it and start editing the code.</div>
<div class="line">Open the example “File” -&gt; “Examples” -&gt; “AmebaWiFi” -&gt; “Firebase.ino”</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image163.png"><img alt="1" src="../../../_images/image163.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>As shown above, ACCESS_TOKEN and SERVER_KEY are defined in the reverse
white part, that is, the ACCESS token ID that we just saved from the APP
and the Server Key saved in the Firebase console page. We fill in the
two sets of IDs, compile and upload them to Ameba. Press the Reset
button and open the terminal.</p>
<a class="reference internal image-reference" href="../../../_images/image173.png"><img alt="1" src="../../../_images/image173.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>Connect to FCM Server after connecting to AP</p>
<a class="reference internal image-reference" href="../../../_images/image183.png"><img alt="1" src="../../../_images/image183.png" style="width: 6.5in; height: 5.43681in;" /></a>
<p>After showing Connect to Server successful, it means that the FCM
connection is successful and the message will be sent. During the
process, HTTP/1.1 200 OK will be received to indicate that the message
is successfully pushed. At this time, the mobile phone screen is opened
and the App receives the message from Ameba.</p>
<a class="reference internal image-reference" href="../../../_images/image193.png"><img alt="1" src="../../../_images/image193.png" style="width: 4.6875in; height: 4.6875in;" /></a>
<p>Code Reference</p>
<div class="line-block">
<div class="line"><strong>Firebase.ino</strong></div>
<div class="line">This example uses the HTTP protocol to push messages. Users can learn
the payload format from the Firebase development website.</div>
</div>
<p><a class="reference external" href="https://firebase.google.com/docs/cloud-messaging/send-message">https://firebase.google.com/docs/cloud-messaging/send-message</a></p>
<p>The main payload format in the program is as follows. The user can
freely change the Title and Body of the message. Body represents the
content of the message.</p>
<p>char const* payload = “{” \</p>
<p>“&quot;to&quot;: \”” ACCESS_TOKEN “&quot;,” \</p>
<p>“&quot;notification&quot;: {” \</p>
<p>“&quot;body&quot;: \”Hello World!&quot;,” \</p>
<p>“&quot;title&quot; : \”From Realtek Ameba&quot; ” \</p>
<p>“} }” ;</p>
<p>setup()</p>
<p>if (client.connect(server, 80)) {</p>
<p>Serial.println(“connected to server”);</p>
<p>// Make a HTTP request:</p>
<p>sprintf(message,”%s%s%s%s%s%d%s%s%s”,”POST /fcm/send
HTTP/1.1nContent-Type: application/jsonnAuthorization:
key=”,SERVER_KEY,”nHost: “,HOST_NAME,”nContent-Length:
“,strlen(payload),”nn”,payload,”n”);</p>
<p>printf(“nRequest:n%s \n”,message);</p>
<p>client.println(message);</p>
<p>client.println();</p>
<p>}</p>
<p>The sprintf part puts the payload into the HTTP POST content and sends
the message out after connecting to the FCM Server.</p>
<p>loop()</p>
<p>while (client.available()) {</p>
<p>char c = client.read();</p>
<p>Serial.write(c);</p>
<p>}</p>
<p>Waiting for the response from Server and printing out the response</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="%5BRTL8722CSM%5D%5BRTL8722DM%5D%20Access%20IFTTT%20Via%20Ameba.html" class="btn btn-neutral float-right" title="[RTL8722CSM][RTL8722DM] Access IFTTT Via Ameba" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20MDNS%20To%20Let%20Arduino%20IDE%20Find%20Ameba.html" class="btn btn-neutral float-left" title="[RTL8722CSM] [RTL8722DM] Use MDNS To Let Arduino IDE Find Ameba" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Ameba IoT.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>